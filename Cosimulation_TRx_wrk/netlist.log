; Top Design: "Cosimulation_TRx_lib:System_TEST_v3_with_flickernoise:schematic"
; Netlisted using Hierarchy Policy: "Standard"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="Cosimulation_TRx_lib:System_TEST_v3_with_flickernoise:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
; Library Name: Cosimulation_TRx_lib
; Cell Name: 15MHz_LED_Model_without_loss
; View Name: schematic
define "15MHz_LED_Model_without_loss" ( Anode  Vout  Cathode ) 
;parameters 
R:R1  Anode N__1 R=1.5 Ohm Noise=yes 
L:L1  N__1 N__3 L=500 pH Noise=yes  
R:R2  N__3 N__2 R=600 mOhm Noise=yes 
C:C1  Cathode N__3 C=150 pF 
C:C2  Cathode N__2 C=2.5 nF 
R:R3  N__9 Cathode R=4 Ohm Noise=yes 
#uselib "ckt" , "CCVS"
CCVS:SRC2  N__2 N__9 Vout Cathode G=100 Ohm T=0.0 nsec R1=0 Ohm R2=0 Ohm F=0.0 GHz 
end "15MHz_LED_Model_without_loss"

; Library Name: Cosimulation_TRx_lib
; Cell Name: 3.5MHz_LED_Model_without_loss
; View Name: schematic
define "3\.5MHz_LED_Model_without_loss" ( Anode  Vout  Cathode ) 
;parameters 
R:R1  Anode N__1 R=1.5 Ohm Noise=yes 
L:L1  N__1 N__3 L=500 pH Noise=yes  
R:R2  N__3 N__2 R=600 mOhm Noise=yes 
C:C1  Cathode N__3 C=6.2 nF 
C:C2  Cathode N__2 C=6 nF 
R:R3  N__9 Cathode R=4 Ohm Noise=yes 
#uselib "ckt" , "CCVS"
CCVS:SRC2  N__2 N__9 Vout Cathode G=100 Ohm T=0.0 nsec R1=0 Ohm R2=0 Ohm F=0.0 GHz 
end "3\.5MHz_LED_Model_without_loss"

; Library Name: Cosimulation_TRx_lib
; Cell Name: 74MHz_LED_Model_without_loss
; View Name: schematic
define "74MHz_LED_Model_without_loss" ( Anode  Vout  Cathode ) 
;parameters 
R:R3  N__6 Cathode R=4 Ohm Noise=yes 
R:R2  N__4 N__5 R=600 mOhm Noise=yes 
R:R1  Anode N__3 R=1.5 Ohm Noise=yes 
L:L1  N__3 N__4 L=500 pH Noise=yes  
C:C2  Cathode N__5 C=0.38 nF 
C:C1  Cathode N__4 C=150 pF 
#uselib "ckt" , "CCVS"
CCVS:SRC2  N__5 N__6 Vout Cathode G=100 Ohm T=0.0 nsec R1=0 Ohm R2=0 Ohm F=0.0 GHz 
end "74MHz_LED_Model_without_loss"

; Library Name: Numeric
; Cell Name: Add2
; View Name: schematic
define Add2 ( N__2  N__1  N__3 ) 
;parameters 
_vKeysightEEsof_dHOF_nNop_lhofstars_pinput_x3d2_aBusMerge2:B1  N__2 N__1 N__0 
_vKeysightEEsof_dSDF_nAdd_lsdfstars:A1  N__0 N__3 
end Add2

; Library Name: Numeric
; Cell Name: AWGN_Channel
; View Name: schematic
define AWGN_Channel ( N__6  N__2 ) 
parameters  FwdTaps="1"  FdbkTaps="0"  NoisePwr=0.5 
_vKeysightEEsof_dHOF_nDelay_lhofstars:D1  N__1 N__0 N=1 
Add2:X1  N__4 N__3 N__2 
_vKeysightEEsof_dSDF_nIID_x5fGaussian_lsdfstars:I2  N__4 Mean=0 Variance=NoisePwr 
_vKeysightEEsof_dSDF_nSub_lsdfstars:S2  N__5 N__0 N__3 
_vKeysightEEsof_dSDF_nFIR_lsdfdspstars:F1  N__6 N__5 Taps=FwdTaps Decimation=1 DecimationPhase=0 Interpolation=1 
_vKeysightEEsof_dSDF_nFIR_lsdfdspstars:F2  N__3 N__1 Taps=FdbkTaps Decimation=1 DecimationPhase=0 Interpolation=1 
end AWGN_Channel

; Library Name: Sinks
; Cell Name: SpectrumAnalyzer
; View Name: schematic
define SpectrumAnalyzer ( N__1 ) 
parameters  Plot=0  RLoad=DefaultRLoad  RTemp=DefaultRTemp  Start=DefaultTimeStart  Stop=DefaultTimeStop  Window=0  WindowConstant=0.0  Bias=1  FStart=0.0  FStop=100e9  NumFreqs=0  NPoints=0  Overlap=0 
_vKeysightEEsof_dTSDF_n_x5fSpectrumAnalyzer_ltsdfsinks:S1  N__1 Plot=Plot RLoad=RLoad RTemp=RTemp Start=Start Stop=Stop Window=Window WindowConstant=WindowConstant Bias=Bias FStart=FStart FStop=FStop NumFreqs=NumFreqs NPoints=NPoints Overlap=Overlap 
R:R1  N__1 0 R=RLoad Temp=RTemp 
end SpectrumAnalyzer

; Library Name: Sinks
; Cell Name: TimedDataWrite
; View Name: schematic
define TimedDataWrite ( N__1 ) 
parameters  Start=DefaultTimeStart  Stop=DefaultTimeStop  RLoad=DefaultRLoad  RTemp=DefaultRTemp  ControlSimulation=1  FileName="" FileType=0 
_vKeysightEEsof_dTSDF_nTimedDataWrite2_ltsdfgemstars:T1  N__1 RLoad=RLoad RTemp=RTemp Start=Start Stop=Stop ControlSimulation=ControlSimulation FileName=FileName FileType=FileType 
R:R1  N__1 0 R=RLoad Temp=RTemp 
end TimedDataWrite

; Library Name: Sinks
; Cell Name: TimedSink
; View Name: schematic
define TimedSink ( N__1 ) 
parameters  Plot=0  RLoad=DefaultRLoad  RTemp=DefaultRTemp  Start=DefaultTimeStart  Stop=DefaultTimeStop  ControlSimulation=1 
R:R1  N__1 0 R=RLoad Temp=RTemp 
_vKeysightEEsof_dTSDF_n_x5fTimedSink_ltsdfsinks:T1  N__1 Plot=Plot RLoad=RLoad RTemp=RTemp Start=Start Stop=Stop ControlSimulation=ControlSimulation 
end TimedSink

; Library Name: Cosimulation_TRx_lib
; Cell Name: Tx_final_with_flickernoise
; View Name: schematic
define Tx_final_with_flickernoise ( Vin  P1  Out  Driver_Out  P2 ) 
;parameters 
#uselib "sml" , "Amplifier2"
Amplifier2:AMP1  Vin Driver_Out S21=dbpolar(20,0) S11=polar(0,0) S22=polar(0,180) S12=0 NF=10 dB NFmin=10 dB GainCompType=0 ReferToInput=0 ClipDataFile=1 
#uselib "ckt" , "VCCS"
VCCS:SRC6  Driver_Out 0 N__21 0 G=1 S T=0.0 nsec R1=1e100 Ohm R2=1e100 Ohm F=0.0 GHz 
"15MHz_LED_Model_without_loss":X1  N__3 N__11 N__1 
#uselib "ckt" , "PIN_diode"
PIN_diode:PinDiode1  N__15 N__14 Noise=yes Model_level=1 Cpack=5 pF 
#uselib "sml" , "Amplifier2"
Amplifier2:AMP3  P2 N__9 S21=dbpolar(89,0) S11=polar(0,0) S22=polar(0,180) S12=0 NF=10 dB NFmin=10 dB GainCompType=0 ReferToInput=0 ClipDataFile=1 
#uselib "ckt" , "CCVS"
CCVS:SRC2  N__13 N__4 P2 0 G=1 Ohm T=0.0 nsec R1=0 Ohm R2=0 Ohm F=0.0 GHz 
#uselib "ckt" , "VCCS"
VCCS:SRC5  P1 0 N__13 N__4 G=0.00000005 S T=0.0 nsec R1=1e100 Ohm R2=1e100 Ohm F=0.0 GHz 
#uselib "ckt" , "PIN_diode"
PIN_diode:PinDiode2  N__13 N__4 Noise=yes Model_level=2 Is=0.57 nA N=1.845 B=1.08 Ikf=10.55 mA Bv=74.9 V Ibv=1.0298 nA Rs=76.197 mOhm Rp=30.1165 MOhm Repi=1.88959 kOhm Rlim=2.069 mOhm W=0.00005 Wd=0.0000001 Tau=2.24 usec Iknee=1.883 mA Rho=0.717 Eps=11.7 Cj=0.78 fF Vj=0.769 V M=0.467 Fc=0.44 Cpack=5 pF Lbond=0.3 nH 
C:C1  N__12 Out C=32.0 nF 
R:R1  Out 0 R=50 Ohm Noise=yes 
"3\.5MHz_LED_Model_without_loss":X3  N__21 P1 0 
"74MHz_LED_Model_without_loss":X4  N__19 N__20 N__18 
#uselib "sml" , "PhaseNoiseMod"
PhaseNoiseMod:MOD1  N__9 N__12 Fnom=3 MHz Rout=50 Ohm Fcorner=5 MHz NF=10 dB QL=500 
end Tx_final_with_flickernoise

SpectrumAnalyzer:S_TIA_Output  N__15 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop Window=2 WindowConstant=0.0 Bias=0 FStart=0.0 Hz FStop=fstop NumFreqs=0 NPoints=Num/16 Overlap=0 
aele SNR1=snr(vout,vout.noise,{1});
SpectrumAnalyzer:S_Driver_Out  N__10 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop Window=2 WindowConstant=0.0 Bias=0 FStart=0.0 Hz FStop=fstop NumFreqs=0 NPoints=Num/16 Overlap=0 

Options:Options1 Tnom=25 TopologyCheck=yes ForceS_Params=yes V_RelTol=1e-3 V_AbsTol=1e-4 V  \
I_RelTol=1e-3 I_AbsTol=1e-8 A GiveAllWarnings=yes MaxWarnings=10 ForceM_Params=yes  \
InitialGuessAnnotation=0 TopologyCheckMessages=no doDeltaAC=no ReduceSPortRatio=0.5 WarnSOA=yes  \
MaxWarnSOA=5 Census=no MinNodalR=1e-2 Ohm LargeCapThreshold=1e-3 F EnableAssertChecks=no EnableSpareRemoval=yes 

TimedSink:T_LED_Output1  N__8 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop ControlSimulation=1 
Tx_final_with_flickernoise:X1  N__18 N__8 N__9 N__10 N__17 
SpectrumAnalyzer:S_LED_Output1  N__8 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop Window=2 WindowConstant=0.0 Bias=0 FStart=0.0 Hz FStop=fstop NumFreqs=0 NPoints=Num/16 Overlap=0 
TimedSink:T_TIA_IN  N__17 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop ControlSimulation=1 
SpectrumAnalyzer:S_TIA_IN  N__17 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop Window=2 WindowConstant=0.0 Bias=0 FStart=0.0 Hz FStop=fstop NumFreqs=0 NPoints=Num/16 Overlap=0 
_vKeysightEEsof_dSDF_nFloatToCx_lsdfstars:F1  N__21 N__14 

fstop=8e8
#uselib "ckt" , "DAC"
DAC:DAC1  File="C:\Users\tminaa\OneDrive - HKUST Connect\VLC_Co-simulation with ADS\MATLAB_ADS_Data\BasebandOutput.tim" Type="tim" InterpMode="linear" InterpDom="ri" ExtrapMode="interpMode" iVar1="time" iVal1=time 
#uselib "ckt" , "DAC"
DAC:DAC_Variable  File="C:\Users\tminaa\OneDrive - HKUST Connect\VLC_Co-simulation with ADS\MATLAB_Code\Channel_model\Parameter_Cal_Result\ChipRate.txt" Type="gmdif" InterpMode="linear" InterpDom="ri" ExtrapMode="interpMode" iVar1="Index" iVal1=1 
_vKeysightEEsof_dTSDF_nCxToTimedIQ_ltsdfstars:C7  N__14 N__18 N__11 TStep=TStep 
TimedSink:T_Input  N__18 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop ControlSimulation=1 
TimedDataWrite:T2  N__15 Start=DefaultTimeStart Stop=DefaultTimeStop RLoad=DefaultRLoad RTemp=DefaultRTemp ControlSimulation=1 FileName="C:/Users/tminaa/OneDrive - HKUST Connect/VLC_Co-simulation with ADS/MATLAB_ADS_Data/BasebandInput.tim" FileType=0 
AWGN_Channel:A1  N__9 N__15 FwdTaps="1" FdbkTaps="0" NoisePwr=0.01 

OverSampling=file{DAC_Variable, "OverSampling"}
NumStop=Num
TStop=Num*TStep
Num=file{DAC_Variable, "Num"}
TStep=1/Fs
Fs=ChipRate*OverSampling
ChipRate=file{DAC_Variable, "ChipRate"}
DefaultNumericStart=0
DefaultNumericStop=NumStop
DefaultTimeStart=0 usec
DefaultTimeStop=TStop
DefaultSeed=1234567
DefaultRIn=50 Ohm
DefaultROut=50 Ohm
DefaultRLoad=1.0e18 Ohm
DefaultRTemp=-273.15
__DefaultPartition=1
__SimulationID=0
_vKeysightEEsof_dTSDF_nDF_ltsdf:DF DefaultTimeUnit=3 DefaultSeed=if (DefaultSeed==0) then 0 else (DefaultSeed+__SimulationID) endif DefaultPartition=__DefaultPartition DeadlockManager=0 CktCosimInputs=0 OutputPlan="DF_Output" 
OutputPlan:DF_Output \
      Type="Output" \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2

TimedSink:T_TIA_Output  N__15 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop ControlSimulation=1 
Tran:Tran1 StartTime=0.0 nsec StopTime=10.0 nsec MaxTimeStep=1.0 nsec LimitStepForTL=yes TimeStepControl=2 TruncTol=7.0 ChargeTol=1.0e-14 IntegMethod=0 MaxGearOrder=2 \
Mu=0.5 MaxOrder=4 Freq[1]=1.0 GHz Order[1]=3 HB_Window=no \
HB_Sol=no ImpApprox=no ShortTL_Delay=1.0 psec ImpMode=1 UseInitCond=no \
LoadGminDC=no CheckKCL=yes CheckOnlyDeltaV=yes OverloadAlert=no DeviceBypass=no \
MaxIters=10 MaxItersDC=200 DevOpPtLevel=0 StatusLevel=2 OutputAllPoints=yes \
NoiseScale=1 ImpEnforcePassivity=yes \
OutputPlan="Tran1_Output" 

OutputPlan:Tran1_Output \
      Type="Output" \
      UseNodeNestLevel=yes \
      NodeNestLevel=2 \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2 \
      UseDeviceCurrentNestLevel=no \
      DeviceCurrentNestLevel=0 \
      DeviceCurrentDeviceType="All" \
      DeviceCurrentSymSyntax=yes \
      UseCurrentNestLevel=yes \
      CurrentNestLevel=999 \
      UseDeviceVoltageNestLevel=no \
      DeviceVoltageNestLevel=0 \
      DeviceVoltageDeviceType="All"

SpectrumAnalyzer:S_Input  N__18 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop Window=2 WindowConstant=0.0 Bias=0 FStart=0.0 Hz FStop=fstop NumFreqs=0 NPoints=Num/16 Overlap=0 
TimedSink:T_Driver_Out  N__10 Plot=0 RLoad=DefaultRLoad RTemp=DefaultRTemp Start=DefaultTimeStart Stop=DefaultTimeStop ControlSimulation=1 
_vKeysightEEsof_dSDF_nConst_lsdfstars:C5  N__21 Level=file{DAC1, "voltage"} 
